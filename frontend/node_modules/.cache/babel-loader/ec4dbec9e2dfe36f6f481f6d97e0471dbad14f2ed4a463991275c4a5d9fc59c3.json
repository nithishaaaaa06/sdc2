{"ast":null,"code":"const PUBLIC_VAPID_KEY_PATH = '/api/push/public-key';\nasync function getPublicKey() {\n  const res = await fetch(PUBLIC_VAPID_KEY_PATH);\n  if (!res.ok) throw new Error('Failed to get VAPID key');\n  const data = await res.json();\n  return urlBase64ToUint8Array(data.publicKey);\n}\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) outputArray[i] = rawData.charCodeAt(i);\n  return outputArray;\n}\nexport async function isSubscribedToPush() {\n  if (!('serviceWorker' in navigator)) return false;\n  const reg = await navigator.serviceWorker.getRegistration();\n  if (!reg || !reg.pushManager) return false;\n  const sub = await reg.pushManager.getSubscription();\n  return !!sub;\n}\nexport async function enableNotifications() {\n  if (!('serviceWorker' in navigator)) throw new Error('No SW');\n  const perm = await Notification.requestPermission();\n  if (perm !== 'granted') return false;\n  const reg = await navigator.serviceWorker.ready;\n  const publicKey = await getPublicKey();\n  const sub = await reg.pushManager.subscribe({\n    userVisibleOnly: true,\n    applicationServerKey: publicKey\n  });\n  await fetch('/api/push/subscribe', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(sub)\n  });\n  return true;\n}\nexport async function disableNotifications() {\n  const reg = await navigator.serviceWorker.getRegistration();\n  if (!reg) return;\n  const sub = await reg.pushManager.getSubscription();\n  if (sub) {\n    await fetch('/api/push/unsubscribe', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        endpoint: sub.endpoint\n      })\n    });\n    await sub.unsubscribe();\n  }\n}","map":{"version":3,"names":["PUBLIC_VAPID_KEY_PATH","getPublicKey","res","fetch","ok","Error","data","json","urlBase64ToUint8Array","publicKey","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","isSubscribedToPush","navigator","reg","serviceWorker","getRegistration","pushManager","sub","getSubscription","enableNotifications","perm","Notification","requestPermission","ready","subscribe","userVisibleOnly","applicationServerKey","method","headers","body","JSON","stringify","disableNotifications","endpoint","unsubscribe"],"sources":["C:/Users/Nithisha/Pictures/project/frontend/src/push.js"],"sourcesContent":["const PUBLIC_VAPID_KEY_PATH = '/api/push/public-key';\r\n\r\nasync function getPublicKey() {\r\n  const res = await fetch(PUBLIC_VAPID_KEY_PATH);\r\n  if(!res.ok) throw new Error('Failed to get VAPID key');\r\n  const data = await res.json();\r\n  return urlBase64ToUint8Array(data.publicKey);\r\n}\r\n\r\nfunction urlBase64ToUint8Array(base64String) {\r\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\r\n  const rawData = window.atob(base64);\r\n  const outputArray = new Uint8Array(rawData.length);\r\n  for (let i = 0; i < rawData.length; ++i) outputArray[i] = rawData.charCodeAt(i);\r\n  return outputArray;\r\n}\r\n\r\nexport async function isSubscribedToPush(){\r\n  if(!('serviceWorker' in navigator)) return false;\r\n  const reg = await navigator.serviceWorker.getRegistration();\r\n  if(!reg || !reg.pushManager) return false;\r\n  const sub = await reg.pushManager.getSubscription();\r\n  return !!sub;\r\n}\r\n\r\nexport async function enableNotifications(){\r\n  if (!('serviceWorker' in navigator)) throw new Error('No SW');\r\n  const perm = await Notification.requestPermission();\r\n  if (perm !== 'granted') return false;\r\n  const reg = await navigator.serviceWorker.ready;\r\n  const publicKey = await getPublicKey();\r\n  const sub = await reg.pushManager.subscribe({ userVisibleOnly: true, applicationServerKey: publicKey });\r\n  await fetch('/api/push/subscribe', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(sub) });\r\n  return true;\r\n}\r\n\r\nexport async function disableNotifications(){\r\n  const reg = await navigator.serviceWorker.getRegistration();\r\n  if(!reg) return;\r\n  const sub = await reg.pushManager.getSubscription();\r\n  if(sub){\r\n    await fetch('/api/push/unsubscribe', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ endpoint: sub.endpoint }) });\r\n    await sub.unsubscribe();\r\n  }\r\n}\r\n\r\n\r\n"],"mappings":"AAAA,MAAMA,qBAAqB,GAAG,sBAAsB;AAEpD,eAAeC,YAAYA,CAAA,EAAG;EAC5B,MAAMC,GAAG,GAAG,MAAMC,KAAK,CAACH,qBAAqB,CAAC;EAC9C,IAAG,CAACE,GAAG,CAACE,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;EACtD,MAAMC,IAAI,GAAG,MAAMJ,GAAG,CAACK,IAAI,CAAC,CAAC;EAC7B,OAAOC,qBAAqB,CAACF,IAAI,CAACG,SAAS,CAAC;AAC9C;AAEA,SAASD,qBAAqBA,CAACE,YAAY,EAAE;EAC3C,MAAMC,OAAO,GAAG,GAAG,CAACC,MAAM,CAAC,CAAC,CAAC,GAAIF,YAAY,CAACG,MAAM,GAAG,CAAE,IAAI,CAAC,CAAC;EAC/D,MAAMC,MAAM,GAAG,CAACJ,YAAY,GAAGC,OAAO,EAAEI,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAC7E,MAAMC,OAAO,GAAGC,MAAM,CAACC,IAAI,CAACJ,MAAM,CAAC;EACnC,MAAMK,WAAW,GAAG,IAAIC,UAAU,CAACJ,OAAO,CAACH,MAAM,CAAC;EAClD,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,OAAO,CAACH,MAAM,EAAE,EAAEQ,CAAC,EAAEF,WAAW,CAACE,CAAC,CAAC,GAAGL,OAAO,CAACM,UAAU,CAACD,CAAC,CAAC;EAC/E,OAAOF,WAAW;AACpB;AAEA,OAAO,eAAeI,kBAAkBA,CAAA,EAAE;EACxC,IAAG,EAAE,eAAe,IAAIC,SAAS,CAAC,EAAE,OAAO,KAAK;EAChD,MAAMC,GAAG,GAAG,MAAMD,SAAS,CAACE,aAAa,CAACC,eAAe,CAAC,CAAC;EAC3D,IAAG,CAACF,GAAG,IAAI,CAACA,GAAG,CAACG,WAAW,EAAE,OAAO,KAAK;EACzC,MAAMC,GAAG,GAAG,MAAMJ,GAAG,CAACG,WAAW,CAACE,eAAe,CAAC,CAAC;EACnD,OAAO,CAAC,CAACD,GAAG;AACd;AAEA,OAAO,eAAeE,mBAAmBA,CAAA,EAAE;EACzC,IAAI,EAAE,eAAe,IAAIP,SAAS,CAAC,EAAE,MAAM,IAAInB,KAAK,CAAC,OAAO,CAAC;EAC7D,MAAM2B,IAAI,GAAG,MAAMC,YAAY,CAACC,iBAAiB,CAAC,CAAC;EACnD,IAAIF,IAAI,KAAK,SAAS,EAAE,OAAO,KAAK;EACpC,MAAMP,GAAG,GAAG,MAAMD,SAAS,CAACE,aAAa,CAACS,KAAK;EAC/C,MAAM1B,SAAS,GAAG,MAAMR,YAAY,CAAC,CAAC;EACtC,MAAM4B,GAAG,GAAG,MAAMJ,GAAG,CAACG,WAAW,CAACQ,SAAS,CAAC;IAAEC,eAAe,EAAE,IAAI;IAAEC,oBAAoB,EAAE7B;EAAU,CAAC,CAAC;EACvG,MAAMN,KAAK,CAAC,qBAAqB,EAAE;IAAEoC,MAAM,EAAC,MAAM;IAAEC,OAAO,EAAC;MAAE,cAAc,EAAC;IAAmB,CAAC;IAAEC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACd,GAAG;EAAE,CAAC,CAAC;EAC/H,OAAO,IAAI;AACb;AAEA,OAAO,eAAee,oBAAoBA,CAAA,EAAE;EAC1C,MAAMnB,GAAG,GAAG,MAAMD,SAAS,CAACE,aAAa,CAACC,eAAe,CAAC,CAAC;EAC3D,IAAG,CAACF,GAAG,EAAE;EACT,MAAMI,GAAG,GAAG,MAAMJ,GAAG,CAACG,WAAW,CAACE,eAAe,CAAC,CAAC;EACnD,IAAGD,GAAG,EAAC;IACL,MAAM1B,KAAK,CAAC,uBAAuB,EAAE;MAAEoC,MAAM,EAAC,MAAM;MAAEC,OAAO,EAAC;QAAE,cAAc,EAAC;MAAmB,CAAC;MAAEC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAEE,QAAQ,EAAEhB,GAAG,CAACgB;MAAS,CAAC;IAAE,CAAC,CAAC;IACxJ,MAAMhB,GAAG,CAACiB,WAAW,CAAC,CAAC;EACzB;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}